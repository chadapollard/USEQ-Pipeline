### Paths to necessary files for USEQ Analysis

# Path to base directory where you want your USEQ files to be created. Don't forget to add a "/" at the end as we want the files to be created inside this directory.
base_dir="/Volumes/Research_Data/USEQ_Analyses/IPS_Dopamanergic_vs_Blood_Plasma/"

# Path to Control Beta values (Make sure it is a .csv file CG's are in the rows and sample names are in the columns)
# control_betas="/Volumes/Research_Data/USEQ_Analyses/Completed_Studies/Low_Income_vs_High_Income_FASZT/under_40k_betas.csv"

# Path to Treatment Beta values (Make sure it is a .csv file and that CG's are in the rows and sample names are in the columns)
# treatment_betas="/Volumes/Research_Data/USEQ_Analyses/Completed_Studies/Low_Income_vs_High_Income_FASZT/over_100k_betas.csv"

# Path to Treatment Beta values (Make sure it is a .csv file and that CG's are in the rows and that CHR and START are in the columns)
# illumina_annotation="/Volumes/Research_Data/My_Github/USEQ-Pipeline/Annotation_Files/EPIC_array_annotation.csv"

# Path to useq_prep_r.R script (This file can be downloaded from this github link: )
# sgr_script="/Volumes/Research_Data/My_Github/USEQ-Pipeline/R_Script.R"

# Path to Sgr2Bar program
Sgr2Bar="/Volumes/Research_Data/My_Github/USEQ-Pipeline/USeq_9.3.3/Apps/Sgr2Bar"

# Path to MethylationArrayScanner program
MethylationArrayScanner="/Volumes/Research_Data/My_Github/USEQ-Pipeline/USeq_9.3.3/Apps/MethylationArrayScanner"

# Path to EnrichedRegionMaker program
EnrichedRegionMaker="/Volumes/Research_Data/My_Github/USEQ-Pipeline/USeq_9.3.3/Apps/EnrichedRegionMaker"

# Path to Control group names (Must be comma delimited with no spaces)
Control_Samples=GSM1255293,GSM1255294,GSM1255295,GSM1255296,GSM1255297,GSM1255298,GSM1255299,GSM1255300,GSM1255301,GSM1255302

# Path to Testing group names (Must be comma delimited with no spaces)
Treatment_Samples=GSM2898875_3999720090_R06C01,GSM2898876_3999720090_R05C01,GSM2898877_3999720090_R02C01,GSM2898878_3999720090_R04C01,GSM2898879_3999720090_R03C01,GSM2898880_3999720090_R01C02,GSM2898881_3999720090_R04C02,GSM2898882_3999720090_R03C02,GSM2898883_3999720090_R02C02,GSM2898884_3999720090_R06C02,GSM2898885_3999720090_R01C01,GSM2898886_3999688032_R02C02,GSM2898887_3999688032_R03C01,GSM2898888_3999688032_R01C01,GSM2898889_3999688032_R05C02,GSM2898890_3999688032_R05C01,GSM2898891_3999688032_R06C01,GSM2898892_3999688032_R06C02,GSM2898893_3999688032_R04C02,GSM2898894_3999688032_R03C02,GSM2898895_3999688032_R01C02,GSM2898896_3999688032_R04C01,GSM2898897_3999688032_R02C01,GSM2898898_3999688057_R05C01,GSM2898899_3999688057_R01C01,GSM2898900_3999688057_R01C02,GSM2898901_3999688057_R03C01,GSM2898902_3999688057_R06C02,GSM2898903_3999688057_R06C01,GSM2898904_3999688057_R02C02,GSM2898905_3999688057_R03C02,GSM2898906_3999688057_R05C02,GSM2898907_3999688057_R04C02,GSM2898908_3999688057_R04C01,GSM2898909_3999688057_R02C01,GSM2898910_3999688055_R03C01,GSM2898911_3999688055_R03C02,GSM2898912_3999688055_R01C02,GSM2898913_3999688055_R02C01,GSM2898914_3999688055_R04C02,GSM2898915_3999688055_R05C02,GSM2898916_3999688055_R01C01,GSM2898917_3999688055_R05C01,GSM2898918_3999688055_R06C02,GSM2898919_3999688055_R04C01,GSM2898920_3999688055_R02C02,GSM2898921_3999688055_R06C01,GSM2898922_3999720119_R02C01,GSM2898923_3999720119_R05C01,GSM2898924_3999720119_R03C01,GSM2898925_3999720119_R06C02,GSM2898926_3999720119_R03C02,GSM2898927_3999720119_R04C02,GSM2898928_3999720119_R02C02,GSM2898929_3999720119_R01C01,GSM2898930_3999720119_R05C02,GSM2898931_3999720119_R06C01,GSM2898932_3999720119_R01C02,GSM2898933_3999720098_R04C01,GSM2898934_3999720098_R03C01,GSM2898935_3999720098_R01C01,GSM2898936_3999720098_R05C02,GSM2898937_3999720098_R04C02,GSM2898938_3999720098_R02C01,GSM2898939_3999720098_R03C02,GSM2898940_3999720098_R05C01,GSM2898941_3999720098_R01C02,GSM2898942_3999720098_R02C02,GSM2898943_3999720098_R06C01,GSM2898944_3999720098_R06C02,GSM2898945_3999876049_R06C02,GSM2898946_3999876049_R03C02,GSM2898947_3999876049_R04C01,GSM2898948_3999876049_R04C02,GSM2898949_3999876049_R05C02,GSM2898950_3999876049_R01C01,GSM2898951_3999876049_R01C02,GSM2898952_3999876049_R02C02,GSM2898953_3999876049_R02C01,GSM2898954_3999876049_R03C01,GSM2898955_3999876049_R06C01,GSM2898956_3999876049_R05C01,GSM2898957_3999720088_R05C02,GSM2898958_3999720088_R01C02,GSM2898959_3999720088_R02C02,GSM2898960_3999720088_R06C01,GSM2898961_3999720088_R03C01,GSM2898962_3999720088_R04C01,GSM2898963_3999720088_R06C02,GSM2898964_3999720088_R01C01,GSM2898965_3999720088_R05C01,GSM2898966_3999720088_R02C01,GSM2898967_3999720088_R04C02,GSM2898968_3999510032_R01C01,GSM2898969_3999510006_R03C01,GSM2898970_3999510032_R01C02,GSM2898971_3999510003_R04C01,GSM2898972_3999510011_R02C02,GSM2898973_3999510034_R04C01,GSM2898974_3999510032_R05C02,GSM2898975_3999510032_R06C01,GSM2898976_3999510051_R05C02,GSM2898977_3999510006_R02C02,GSM2898978_3999510003_R04C02,GSM2898979_3999510051_R06C01,GSM2898980_3999510034_R05C01,GSM2898981_3999510051_R01C02,GSM2898982_3999510003_R05C01,GSM2898983_3999510032_R02C01,GSM2898984_3999510034_R04C02,GSM2898985_3999510032_R06C02,GSM2898986_3999510051_R06C02,GSM2898987_3999510011_R03C01,GSM2898988_3999510006_R03C02,GSM2898989_3999510051_R02C01,GSM2898990_3999510011_R03C02,GSM2898991_3999510003_R01C02,GSM2898992_3999510051_R02C02,GSM2898993_3999510003_R01C01,GSM2898994_3999510032_R02C02,GSM2898995_3999510006_R04C01,GSM2898996_3999510034_R05C02,GSM2898997_3999510003_R05C02,GSM2898998_3999510003_R06C01,GSM2898999_3999510034_R01C01,GSM2899000_3999510011_R04C01,GSM2899001_3999510006_R04C02,GSM2899002_3999510011_R04C02,GSM2899003_3999510034_R02C01,GSM2899004_3999510006_R05C01,GSM2899005_3999510034_R01C02,GSM2899006_3999510011_R05C01,GSM2899007_3999510032_R03C02,GSM2899008_3999510051_R03C02,GSM2899009_3999510003_R02C01,GSM2899010_3999510034_R06C02,GSM2899011_3999510034_R06C01,GSM2899012_3999510011_R05C02,GSM2899013_3999510006_R01C01,GSM2899014_3999510003_R02C02,GSM2899015_3999510011_R01C01,GSM2899016_3999510003_R03C01,GSM2899017_3999510032_R04C02,GSM2899018_3999510051_R04C01,GSM2899019_3999510006_R05C02,GSM2899020_3999510006_R06C01,GSM2899021_3999510032_R04C01,GSM2899022_3999510034_R02C02,GSM2899023_3999510032_R05C01,GSM2899024_3999510011_R01C02,GSM2899025_3999510006_R02C01,GSM2899026_3999510011_R02C01,GSM2899027_3999510011_R06C01,GSM2899028_3999510034_R03C01,GSM2899029_3999510006_R06C02,GSM2899030_3999510051_R04C02,GSM2899031_3999510003_R03C02,GSM2899032_3999510011_R06C02,GSM2899033_3999510051_R05C01,GSM2899034_9761749026_R01C01,GSM2899035_9761749026_R02C01,GSM2899036_9761749026_R03C01,GSM2899037_9761749026_R04C01,GSM2899038_9761749026_R06C01,GSM2899039_9761749026_R01C02,GSM2899040_9761749026_R02C02,GSM2899041_9761749026_R03C02,GSM2899042_9761749026_R04C02,GSM2899043_9761749026_R05C02,GSM2899044_9761749026_R06C02,GSM2899045_9985131045_R01C01,GSM2899046_9985131045_R02C01,GSM2899047_9985131045_R04C01,GSM2899048_9985131045_R05C01,GSM2899049_9985131045_R06C01,GSM2899050_9985131045_R01C02,GSM2899051_9985131045_R02C02,GSM2899052_9985131045_R03C02,GSM2899053_9985131045_R04C02,GSM2899054_9985131045_R05C02,GSM2899055_9985131045_R06C02



###########
## Creating USEQ Directories ##
###########
echo ""
echo "**** Creating USEQ Directories ****"
echo ""

# Change to USEQ_prep directory
cd $base_dir
mkdir USEQ_Prep
mkdir USEQ_Results_Forward
mkdir USEQ_Results_Reverse
USEQ_Prep="${base_dir}/USEQ_Prep/"
cd $USEQ_Prep

###########
## Creating SGR Files ##
###########
echo ""
echo "**** Running R-Script and Creating SGR Files ****"
echo ""

# Rscript $sgr_script --base_dir $base_dir --control_betas $control_betas --treatment_betas $treatment_betas --illumina_annotation $illumina_annotation --USEQ_Prep $USEQ_Prep

###########
## Converting SGR Files to Bar Files ##
###########
echo ""
echo "**** Converting SGR Files to Bar Files ****"
echo ""

# Convert .sgr files to .bar files
for d in ./*/ ; do (java -jar $Sgr2Bar -f $USEQ_Prep${d} -v H_Sapiens_Feb_2009); done

###########
## Removing SGR files ##
###########
echo ""
echo "**** Removing SGR files ****"
echo ""

# Remove .sgr files
for d in ./*/ ; do (cd "$d" && rm *.sgr); done


###########
## Removing Leftover Subdirectories ##
###########
echo ""
echo "**** Removing Leftover Subdirectories ****"
echo ""

# Move any file in the sub directory and place it into the working directory
for d in ./*/ ; do (cd "$d" && find . -mindepth 2 -type f -print -exec mv {} . \;); done

# Remove subdirectories
for d in ./*/ ; do (cd "$d" && rm -R -- */); done


###########
## Running Sliding Window Analysis Forward ##
###########
echo ""
echo "**** Running Sliding Window Analysis Forward ****"
echo ""

#Sliding Window Analysis
java -jar $MethylationArrayScanner -s ../USEQ_Results_Forward -d $USEQ_Prep -c $Control_Samples -t $Treatment_Samples -n

###########
## Creating Output Using Enriched Region Maker App ##
###########
echo ""
echo "**** Creating Forward Output Using Enriched Region Maker App ****"
echo ""

#Creating output using enriched region maker app
java -jar $EnrichedRegionMaker -f ../USEQ_Results_Forward/windowData1000bp0.2MinPse.swi -i 0,1 -s 0.2,10


###########
## Running Sliding Window Analysis Reverse ##
###########
echo ""
echo "**** Running Sliding Window Analysis Reverse ****"
echo ""

java -jar $MethylationArrayScanner -s ../USEQ_Results_Reverse -d $USEQ_Prep -t $Control_Samples -c $Treatment_Samples -n


###########
## Creating Output Using Enriched Region Maker App ##
###########
echo ""
echo "**** Creating Reverse Output Using Enriched Region Maker App ****"
echo ""

#Creating output using enriched region maker app
java -jar $EnrichedRegionMaker -f ../USEQ_Results_Reverse/windowData1000bp0.2MinPse.swi -i 0,1 -s 0.2,10
echo "Finished!"